# Railway Configuration for All Services
# This is for reference - Railway uses this structure

services:
  # Frontend Service
  frontend:
    source: frontend/
    build:
      buildCommand: npm ci && npm run build
      startCommand: npm run preview -- --host 0.0.0.0 --port $PORT
    variables:
      NODE_ENV: production
      VITE_API_URL: https://easypass-backend.up.railway.app
      VITE_APP_NAME: EasyPass EMS
      VITE_APP_VERSION: 1.0.0

  # Backend Service  
  backend:
    source: backend/
    build:
      buildCommand: composer install --no-dev --optimize-autoloader
      startCommand: php artisan migrate --force && php artisan serve --host=0.0.0.0 --port=$PORT
    variables:
      APP_NAME: EasyPass
      APP_ENV: production
      APP_DEBUG: false
      APP_URL: https://easypass-backend.up.railway.app
      DB_CONNECTION: mysql
      DB_HOST: ${{MYSQLHOST}}
      DB_PORT: ${{MYSQLPORT}}
      DB_DATABASE: ${{MYSQLDATABASE}}
      DB_USERNAME: ${{MYSQLUSER}}
      DB_PASSWORD: ${{MYSQLPASSWORD}}
      CORS_ALLOWED_ORIGINS: https://easypass-frontend.up.railway.app
      LOG_CHANNEL: stderr

  # MySQL Database Service
  database:
    image: mysql:8.0
    variables:
      MYSQL_ROOT_PASSWORD: ${{MYSQL_ROOT_PASSWORD}}
      MYSQL_DATABASE: easypass
      MYSQL_USER: easypass
      MYSQL_PASSWORD: ${{MYSQL_PASSWORD}}
